import{u as X,a as Y,r as j,b as F,R as H,K as L,s as K,c as V,d as Z,e as J,f as $,g as R,j as e,T as Q,C as k,h as ee,i as te,k as O,B as I,l as se,m as re,n as ne,D as ae,o as ie,p as w,A as oe,q as de,t as A,v as le,P as ce,w as z,x as _,y as G,z as ue,E as he}from"./index-DHawlayY.js";function me(n,a,o){const r=n.slice();return r.splice(o<0?r.length+o:o,0,r.splice(a,1)[0]),r}function xe(n,a){return n.reduce((o,r,d)=>{const u=a.get(r);return u&&(o[d]=u),o},Array(n.length))}function fe(n,a){if(n===a)return!0;if(n.length!==a.length)return!1;for(let o=0;o<n.length;o++)if(n[o]!==a[o])return!1;return!0}function ge(n){return typeof n=="boolean"?{draggable:n,droppable:n}:n}const B=n=>{let{rects:a,activeIndex:o,overIndex:r,index:d}=n;const u=me(a,r,o),m=a[d],c=u[d];return!c||!m?null:{x:c.left-m.left,y:c.top-m.top,scaleX:c.width/m.width,scaleY:c.height/m.height}},P={scaleX:1,scaleY:1},pe=n=>{var a;let{activeIndex:o,activeNodeRect:r,index:d,rects:u,overIndex:m}=n;const c=(a=u[o])!=null?a:r;if(!c)return null;if(d===o){const y=u[m];return y?{x:0,y:o<m?y.top+y.height-(c.top+c.height):y.top-c.top,...P}:null}const N=ve(u,d,o);return d>o&&d<=m?{x:0,y:-c.height-N,...P}:d<o&&d>=m?{x:0,y:c.height+N,...P}:{x:0,y:0,...P}};function ve(n,a,o){const r=n[a],d=n[a-1],u=n[a+1];return r?o<a?d?r.top-(d.top+d.height):u?u.top-(r.top+r.height):0:u?u.top-(r.top+r.height):d?r.top-(d.top+d.height):0:0}const W="Sortable",je=H.createContext({activeIndex:-1,containerId:W,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:B,disabled:{draggable:!1,droppable:!1}});function ye(n){let{children:a,id:o,items:r,strategy:d=B,disabled:u=!1}=n;const{active:m,dragOverlay:c,droppableRects:N,over:y,measureDroppableContainers:x}=X(),b=Y(W,o),T=c.rect!==null,f=j.useMemo(()=>r.map(s=>typeof s=="object"&&"id"in s?s.id:s),[r]),D=m!=null,C=m?f.indexOf(m.id):-1,S=y?f.indexOf(y.id):-1,E=j.useRef(f),t=!fe(f,E.current),i=S!==-1&&C===-1||t,l=ge(u);F(()=>{t&&D&&x(f)},[t,f,D,x]),j.useEffect(()=>{E.current=f},[f]);const g=j.useMemo(()=>({activeIndex:C,containerId:b,disabled:l,disableTransforms:i,items:f,overIndex:S,useDragOverlay:T,sortedRects:xe(f,N),strategy:d}),[C,b,l.draggable,l.droppable,i,f,S,N,T,d]);return H.createElement(je.Provider,{value:g},a)}L.Down,L.Right,L.Up,L.Left;function Ne({tasks:n,onTaskClick:a,onTaskUpdate:o}){const[r,d]=j.useState("week"),[u,m]=j.useState(()=>{const t=n.reduce((i,l)=>l.startTime<i?l.startTime:i,new Date);return K(t)}),[c,N]=j.useState(null),y=V(Z(he,{activationConstraint:{distance:8}})),x=j.useMemo(()=>J({start:u,end:$(u,r==="day"?30:r==="week"?90:180)}),[u,r]),b=j.useMemo(()=>{const t=new Map;n.forEach(s=>{s.category==="Task"&&t.set(s.id,{...s,dependencies:s.dependencies||[],level:0,criticalPath:!1,resourceLoad:Math.random()*100,milestones:[{date:s.startTime,title:"Start"},...s.endTime?[{date:s.endTime,title:"End"}]:[]]})});const i=new Map;t.forEach(s=>i.set(s.id,s.dependencies.slice()));const l=[];for(t.forEach((s,p)=>{(!s.dependencies||s.dependencies.length===0)&&(l.push(p),s.level=0)});l.length;){const s=l.shift(),p=t.get(s);t.forEach(h=>{if(h.dependencies&&h.dependencies.includes(s)){const v=p.level+1;v>h.level&&(h.level=v,l.push(h.id))}})}const g=new Date;return t.forEach(s=>{var v;const p=s.endTime&&s.endTime<g&&s.status!=="done",h=s.priority==="urgent"||s.priority==="high";if(s.criticalPath=!!(p||h&&(((v=s.dependencies)==null?void 0:v.length)||0)>0),typeof s.estimatedHours=="number")s.resourceLoad=Math.min(100,Math.max(0,s.estimatedHours/40*100));else if(s.endTime){const M=Math.max(1,Math.abs((s.endTime.getTime()-s.startTime.getTime())/36e5));s.resourceLoad=Math.min(100,M/40*100)}else s.resourceLoad=10}),Array.from(t.values()).sort((s,p)=>s.level-p.level)},[n]),T=j.useCallback(t=>{const i=t.startTime,l=t.endTime||$(t.startTime,1),g=Math.max(1,R(x[x.length-1],x[0])),s=Math.max(1,R(l,i)),p=R(i,x[0])/g*100,h=s/g*100;return{left:Math.max(0,p),width:Math.max(1,h)}},[x]),f=t=>{const i=r==="day"?7:r==="week"?14:30;m(l=>$(l,t==="next"?i:-i))},D=t=>t.criticalPath?"bg-red-500":t.status==="done"?"bg-green-500":t.status==="in_progress"?"bg-blue-500":t.status==="blocked"?"bg-orange-500":"bg-gray-400",C=t=>{switch(t){case"urgent":return"border-l-red-500";case"high":return"border-l-orange-500";case"medium":return"border-l-yellow-500";case"low":return"border-l-green-500";default:return"border-l-gray-500"}},S=t=>{const{active:i}=t,l=b.find(g=>g.id===i.id);N(l||null)},E=t=>{const{active:i,over:l}=t;if(N(null),!l||i.id===l.id)return;const g=b.find(s=>s.id===i.id);g&&console.log("Task dragged:",g.title,"to position:",l.id)};return e.jsx(Q,{children:e.jsxs(k,{className:"w-full",children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Gantt Chart"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",size:"sm",onClick:()=>f("prev"),children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>f("next"),children:e.jsx(re,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex border rounded",children:[e.jsx(I,{variant:r==="day"?"default":"ghost",size:"sm",onClick:()=>d("day"),className:"rounded-r-none",children:"Day"}),e.jsx(I,{variant:r==="week"?"default":"ghost",size:"sm",onClick:()=>d("week"),className:"rounded-none",children:"Week"}),e.jsx(I,{variant:r==="month"?"default":"ghost",size:"sm",onClick:()=>d("month"),className:"rounded-l-none",children:"Month"})]})]})]})}),e.jsx(ne,{className:"p-0",children:e.jsxs(ae,{sensors:y,collisionDetection:ie,onDragStart:S,onDragEnd:E,children:[e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"flex border-b bg-muted/50",children:[e.jsx("div",{className:"w-80 p-4 font-medium border-r",children:"Task"}),e.jsx("div",{className:"flex-1 flex",children:r==="month"?x.filter((t,i)=>i%30===0).map(t=>e.jsx("div",{className:"flex-1 p-2 text-center border-r text-sm font-medium",children:w(t,"MMM yyyy")},t.toISOString())):r==="week"?x.filter((t,i)=>i%7===0).map(t=>e.jsx("div",{className:"flex-1 p-2 text-center border-r text-sm font-medium",children:w(t,"MMM d")},t.toISOString())):x.filter((t,i)=>i%7===0).map(t=>e.jsx("div",{className:"flex-1 p-2 text-center border-r text-sm font-medium",children:w(t,"MMM d")},t.toISOString()))})]}),e.jsx(ye,{items:b.map(t=>t.id),strategy:pe,children:b.map((t,i)=>{var s,p;const l=T(t),g=t.status==="done"?100:t.status==="in_progress"?50:0;return e.jsxs("div",{className:"flex border-b hover:bg-muted/30",children:[e.jsx("div",{className:"w-80 p-4 border-r",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${D(t)}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate cursor-pointer hover:text-primary",onClick:()=>a==null?void 0:a(t),children:t.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[t.assignee&&e.jsx(oe,{className:"h-6 w-6",children:e.jsx(de,{className:"text-xs",children:t.assignee.charAt(0).toUpperCase()})}),e.jsx(A,{variant:"outline",className:"text-xs",children:((s=t.status)==null?void 0:s.replace("_"," "))||"To Do"}),t.criticalPath&&e.jsxs(A,{variant:"destructive",className:"text-xs",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),"Critical"]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Resource Load: ",Math.round(t.resourceLoad),"%"]}),e.jsx(ce,{value:t.resourceLoad,className:"h-1 w-16"})]})]})]})}),e.jsxs("div",{className:"flex-1 relative h-20 border-r",children:[e.jsxs(z,{children:[e.jsx(_,{asChild:!0,children:e.jsxs("div",{className:`absolute top-6 h-8 rounded cursor-pointer hover:opacity-80 transition-opacity ${D(t)} ${C(t.priority)} border-l-4`,style:{left:`${l.left}%`,width:`${l.width}%`,minWidth:"20px"},onClick:()=>a==null?void 0:a(t),children:[e.jsx("div",{className:"px-2 py-1 text-white text-xs font-medium truncate",children:t.title}),g>0&&e.jsx("div",{className:"absolute bottom-0 left-0 h-1 bg-white/30 rounded-bl",style:{width:`${g}%`}})]})}),e.jsx(G,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:t.title}),e.jsxs("div",{children:["Start: ",w(t.startTime,"MMM d, yyyy")]}),t.endTime&&e.jsxs("div",{children:["End: ",w(t.endTime,"MMM d, yyyy")]}),e.jsxs("div",{children:["Status: ",((p=t.status)==null?void 0:p.replace("_"," "))||"To Do"]}),t.assignee&&e.jsxs("div",{children:["Assignee: ",t.assignee]}),e.jsxs("div",{children:["Resource Load: ",Math.round(t.resourceLoad),"%"]})]})})]}),t.milestones.map((h,v)=>{const M=R(h.date,x[0])/R(x[x.length-1],x[0])*100;return e.jsxs(z,{children:[e.jsx(_,{asChild:!0,children:e.jsx("div",{className:"absolute top-2 w-3 h-3 bg-yellow-500 rounded-full border-2 border-white shadow-sm",style:{left:`${M}%`}})}),e.jsx(G,{children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium",children:h.title}),e.jsx("div",{children:w(h.date,"MMM d, yyyy")})]})})]},v)}),t.dependencies.map(h=>{const v=b.find(U=>U.id===h);if(!v)return null;const M=T(v),q=l;return e.jsxs("svg",{className:"absolute inset-0 pointer-events-none",style:{zIndex:1},children:[e.jsx("defs",{children:e.jsx("marker",{id:`arrowhead-${h}`,markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"currentColor",className:"text-muted-foreground"})})}),e.jsx("path",{d:`M ${M.left+M.width}% ${i*80+40} L ${q.left}% ${i*80+40}`,stroke:"currentColor",strokeWidth:"1",strokeDasharray:"2,2",className:"text-muted-foreground",markerEnd:`url(#arrowhead-${h})`})]},h)})]})]},t.id)})}),b.length===0&&e.jsxs("div",{className:"p-8 text-center text-muted-foreground",children:[e.jsx(O,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-lg font-medium",children:"No tasks to display"}),e.jsx("p",{className:"text-sm",children:"Create some tasks to see the Gantt chart"})]})]}),e.jsx(ue,{children:c?e.jsxs("div",{className:"bg-white border rounded shadow-lg p-2",children:[e.jsx("div",{className:"font-medium text-sm",children:c.title}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[w(c.startTime,"MMM d")," - ",c.endTime?w(c.endTime,"MMM d"):"No end date"]})]}):null})]})})]})})}export{Ne as default};
